.. _usage_expression:

Parcellating expression data
============================

Now that the microarray data have been downloaded and we have a parcellation,
we can process the data. This is as simple as:

.. code-block:: python

    >>> expression = abagen.get_expression_data(atlas['image'], atlas['info'])

.. note::

    Wrangling all the raw microarray data can be quite time-consuming! If you'd
    like to speed up this step you can make sure you've performed the
    :ref:`io_installation`.

The ``expression`` object returned is a :class:`pandas.DataFrame`, where rows
correspond to region labels as defined in our atlas image, columns correspond
to genes, and entry values are normalized microarray expression data averaged
across donors:

.. code-block:: python

    >>> expression.head()
    gene_symbol      A1BG  A1BG-AS1       A2M  ...       ZYX     ZZEF1      ZZZ3
    label                                      ...
    1            0.519351  0.828700  0.453306  ...  0.550029  0.223340  0.381796
    2            0.419609  0.757244  0.444827  ...  0.442332  0.116300  0.523904
    3                 NaN       NaN       NaN  ...       NaN       NaN       NaN
    4            0.533572  0.860614  0.453581  ...  0.486976  0.184656  0.592856
    5            0.550198  0.745571  0.469597  ...  0.652835  0.258184  0.587019

    [5 rows x 15656 columns]


Unfortunately, due to how tissue samples were collected from the donor brains,
it is possible that some regions in an atlas may not be represented by any
expression data. As you can see above, the third row is filled with NaN values.
That region, corresponding to the right frontal pole in the Desikan-Killiany
atlas, was not matched to any tissue samples; this is likely due to the fact
that only two of the six donors had any tissue samples taken from the right
hemisphere.

If you require a full matrix with expression data for *every* region, you can
specify the following:

.. code-block:: python

    >>> expression = abagen.get_expression_data(atlas['image'], atlas['info'], exact=False)
    >>> expression.head()
    gene_symbol      A1BG  A1BG-AS1       A2M  ...       ZYX     ZZEF1      ZZZ3
    label                                      ...
    1            0.514177  0.828355  0.453783  ...  0.552014  0.223837  0.379434
    2            0.414703  0.756921  0.444710  ...  0.444384  0.116857  0.521554
    3            0.628218  0.995734  0.239491  ...  0.519363  0.023518  0.612133
    4            0.528599  0.860405  0.453873  ...  0.489035  0.185246  0.590921
    5            0.545804  0.745178  0.470199  ...  0.654884  0.258185  0.585447

    [5 rows x 15656 columns]

By default, :func:`abagen.get_expression_data` will attempt to be as precise as
possible in matching microarray samples with brain regions. Specifying
``exact=False`` will, at the cost of this precision, ensure that every brain
region is matched to *at least* one sample.

You can investigate other options for modifying how the ``expression`` array is
generated by looking at the :ref:`api_ref`.
